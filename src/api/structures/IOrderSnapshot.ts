import { tags } from "typia";

/**
 * OrderSnapshot(order 변경이력/스냅샷) 데이터 스키마입니다.
 *
 * AI 쇼핑몰 주문(Order) 시스템의 불변 변경이력, 상태 롤백, 컴플라이언스 감사 근거로 저장되는 엔터티 구조입니다.
 *
 * 주문 상태/항목의 '변경' 발생 시점마다 기록하며, idempotent/immutable 하게 새 row로만 누적되어 저장됩니다.
 *
 * @autobe Generated by AutoBE - https://github.com/wrtnlabs/autobe
 */
export type IOrderSnapshot = {
  /** 스냅샷 고유 식별자 (order_snapshots.id PK). */
  id: string & tags.Format<"uuid">;

  /** 스냅샷이 찍힌 주문(order)의 id. FK: orders.id, rollback 시 주참조. */
  order_id: string & tags.Format<"uuid">;

  /** 상태 변경/스냅샷 생성 요청을 행한 사용자 id. (FK: users.id) */
  actor_id: string & tags.Format<"uuid">;

  /**
   * 주문의 (Json 직렬화) 상세 데이터 내용. 버전 rollback/감사/분쟁 대응에서 필요.
   *
   * AI 쇼핑몰 시스템 확장성을 고려해, 주문 전체 state(export 가능) json 구조, 혹은 지정된 스냅샷 포맷 DB에
   * 저장됨.
   */
  snapshot_data: string;

  /** 스냅샷 생성 시각. */
  created_at: string & tags.Format<"date-time">;
};
export namespace IOrderSnapshot {
  /**
   * OrderSnapshot 목록/조회용 페이로드 스키마입니다.
   *
   * 주문 변경이력, 버전 롤백 대시보드, 컴플라이언스 검증 등에 쓰이며, 필터 및 페이징, 범위검색 옵션이 강력히 요구됨.
   */
  export type IRequest = {
    /** 조회/검색 대상 주문의 ID (orders.id). 필터 조건. */
    order_id?: string & tags.Format<"uuid">;

    /** 스냅샷 이력을 남긴(수행자) 사용자 ID. 관리자/고객/판매자 구분용 필터. */
    actor_id?: string & tags.Format<"uuid">;

    /** 검색 기준(시작) - created_at timestamp (>=) ISO format. */
    start_date?: string & tags.Format<"date-time">;

    /** 검색 기준(종료) - created_at timestamp (<=) ISO format. */
    end_date?: string & tags.Format<"date-time">;

    /** 페이지 번호. 1-base 인덱스. */
    page?: number &
      tags.Type<"int32"> &
      tags.Default<1> &
      tags.Minimum<1> &
      tags.JsonSchemaPlugin<{
        format: "int32";
      }>;

    /** 1 페이지당 최대 스냅샷 개수. */
    limit?: number &
      tags.Type<"int32"> &
      tags.Default<50> &
      tags.Minimum<1> &
      tags.Maximum<1000> &
      tags.JsonSchemaPlugin<{
        format: "int32";
      }>;
  };

  /**
   * 주문 변경 스냅샷 신규 생성 요청 타입 (OrderSnapshot 신규 row 등록).
   *
   * 주문(orders) 변경 시점마다 해당 주문의 상태/데이터 전체를 JSON으로 직렬화하여 불변 스냅샷으로 저장합니다. 보통
   * 롤백/복구/감사 이슈 대응에 쓰입니다.
   */
  export type ICreate = {
    /**
     * 스냅샷 생성 대상 주문의 ID.
     *
     * Orders.id; 유효한 주문이 존재해야 생성 가능.
     */
    order_id: string & tags.Format<"uuid">;

    /** 스냅샷을 생성한 사용자(담당자, 판매자, 관리자 또는 고객)의 ID. */
    actor_id: string & tags.Format<"uuid">;

    /** 주문 스냅샷 데이터 전체 (JSON 직렬화된 주문 현 상태). */
    snapshot_data: string;
  };

  /**
   * Meta-update request body schema for correcting or annotating the order
   * snapshot record (`order_snapshots`).
   *
   * Normally, order snapshots are immutable; this structure only permits
   * controlled addition of metadata or annotation by privileged
   * admin/compliance users, in accordance with audit policies. No actual
   * order data or state can be changed through this interface.
   *
   * The field(s) are only used for compliance-driven corrections or to add
   * rationale for redaction, not for business-driven content changes.
   */
  export type IUpdate = {
    /**
     * Metadata or annotation for this snapshot update.
     *
     * Free-form text or code, allows admins/compliance to attach context
     * for a correction or override. Not related to the immutable snapshot
     * data fields.
     */
    annotation?: string;
  };
}
